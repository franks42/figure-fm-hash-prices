<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saturation Gradient Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white p-8">
    
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 text-cyan-400">
                Saturation Gradient Implementation Test
            </h1>
            <p class="text-gray-400">Testing seamless gradient transitions for subliminal percentage messaging</p>
        </header>
        
        <!-- Test the ClojureScript function -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-green-400">ClojureScript Function (Simulated)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="test-results">
                <!-- Results will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Visual gradient spectrum -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-green-400">Visual Gradient Spectrum</h2>
            <div class="space-y-1" id="gradient-spectrum">
                <!-- Spectrum will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <script>
        // JavaScript implementation of the ClojureScript gradient function
        function getChangeColor(percentChange) {
            const absChange = Math.abs(percentChange);
            // Cap at 10% - anything above 10% gets same max intensity (extreme)
            const cappedChange = Math.min(absChange, 10.0);
            // Map 0% to 10% onto 0.1 to 0.8 opacity (seamless gradient)
            let intensity = Math.min(cappedChange * 0.08, 0.8); // 0.08 = 8% per percent change
            intensity = Math.max(intensity, 0.1); // Minimum visibility
            
            if (percentChange > 0.05) { // Positive > 0.05%
                return {
                    textColor: `rgba(0, 255, 65, ${Math.min(intensity + 0.2, 1.0)})`, // Neon green text
                    bgColor: `rgba(0, 255, 65, ${intensity * 0.15})`, // Subtle green background
                    borderColor: `rgba(0, 255, 65, ${intensity * 0.3})`
                };
            } else if (percentChange < -0.05) { // Negative < -0.05%
                return {
                    textColor: `rgba(220, 38, 38, ${Math.min(intensity + 0.2, 1.0)})`, // Red text
                    bgColor: `rgba(220, 38, 38, ${intensity * 0.15})`, // Subtle red background
                    borderColor: `rgba(220, 38, 38, ${intensity * 0.3})`
                };
            } else { // Nearly flat (-0.05% to +0.05%)
                return {
                    textColor: "rgba(156, 163, 175, 0.8)", // Neutral gray
                    bgColor: "rgba(107, 114, 128, 0.1)", // Very subtle gray background
                    borderColor: "rgba(107, 114, 128, 0.2)"
                };
            }
        }
        
        // Test cases - including extremes to show capping at 10%
        const testCases = [
            -25, -15, -10, -5, -2, -1, -0.5, -0.1, -0.01,
            0, 0.01, 0.1, 0.5, 1, 2, 5, 10, 15, 25
        ];
        
        // Populate test results
        const testContainer = document.getElementById('test-results');
        testCases.forEach(pct => {
            const colors = getChangeColor(pct);
            const arrow = pct > 0.05 ? "â–²" : (pct < -0.05 ? "â–¼" : "â€¢");
            
            const div = document.createElement('div');
            div.className = 'p-4 rounded-lg border transition-all duration-300';
            div.style.backgroundColor = colors.bgColor;
            div.style.borderColor = colors.borderColor;
            div.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-lg font-bold" style="color: ${colors.textColor}">
                        ${arrow}${Math.abs(pct).toFixed(2)}%
                    </span>
                    <div class="text-right text-sm text-gray-400">
                        <div>Capped: ${Math.min(Math.abs(pct), 10.0).toFixed(2)}%</div>
                        <div>Intensity: ${Math.min(Math.min(Math.abs(pct), 10.0) * 0.08, 0.8).toFixed(2)}</div>
                        <div>Type: ${pct > 0.05 ? 'Positive' : (pct < -0.05 ? 'Negative' : 'Neutral')}</div>
                    </div>
                </div>
            `;
            testContainer.appendChild(div);
        });
        
        // Create gradient spectrum visualization - extending to show capping
        const spectrumContainer = document.getElementById('gradient-spectrum');
        for (let pct = -20; pct <= 20; pct += 0.5) {
            const colors = getChangeColor(pct);
            
            const div = document.createElement('div');
            div.className = 'flex items-center h-8';
            div.style.backgroundColor = colors.bgColor;
            div.style.borderLeft = `3px solid ${colors.borderColor}`;
            div.innerHTML = `
                <span class="ml-3 text-xs font-mono" style="color: ${colors.textColor}">
                    ${pct > 0 ? '+' : ''}${pct.toFixed(2)}%
                </span>
            `;
            spectrumContainer.appendChild(div);
        }
        
        console.log('ðŸŽ¨ Saturation gradient test loaded');
        console.log('ðŸ“Š Test cases:', testCases.length);
        console.log('ðŸŒˆ Gradient spectrum: -12% to +12% in 0.25% increments');
    </script>
</body>
</html>
