<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Price Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/scittle@0.6.17/dist/scittle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/scittle@0.6.17/dist/scittle.reagent.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }
        
        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(120, 20, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 20, 147, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 20%, rgba(20, 147, 255, 0.1) 0%, transparent 50%);
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-20px, -20px) rotate(1deg); }
            66% { transform: translate(20px, -10px) rotate(-1deg); }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 50px;
            padding-top: 30px;
        }
        
        h1 {
            font-size: 3.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 50%, #ff00ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: glow 3s ease-in-out infinite;
        }
        
        @keyframes glow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }
        
        .subtitle {
            color: #888;
            font-size: 1.1em;
            font-weight: 300;
        }
        
        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .crypto-card { 
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .crypto-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ff88, #00ccff, #ff00ff);
            transform: translateX(-100%);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .crypto-card:hover {
            transform: translateY(-5px) scale(1.02);
            background: rgba(255, 255, 255, 0.06);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3),
                        0 0 60px rgba(120, 20, 255, 0.1);
        }
        
        .crypto-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .crypto-info {
            display: flex;
            align-items: center;
        }
        
        .crypto-icon {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: linear-gradient(135deg, rgba(120, 20, 255, 0.2) 0%, rgba(255, 20, 147, 0.2) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .crypto-name {
            font-size: 1.1em;
            font-weight: 600;
            color: #fff;
            letter-spacing: 0.5px;
        }
        
        .crypto-symbol {
            font-size: 0.85em;
            color: #666;
            margin-left: 8px;
            text-transform: uppercase;
        }
        
        .price { 
            font-size: 2.2em; 
            font-weight: 700;
            margin-bottom: 15px;
            font-variant-numeric: tabular-nums;
            letter-spacing: -1px;
        }
        
        .change-container {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .change-positive { 
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .change-negative { 
            background: rgba(255, 77, 90, 0.1);
            color: #ff4d5a;
            border: 1px solid rgba(255, 77, 90, 0.2);
        }
        
        .arrow {
            margin-right: 5px;
            font-size: 1.1em;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .stat {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 0.75em;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 1em;
            font-weight: 600;
            color: #fff;
            font-variant-numeric: tabular-nums;
        }
        
        .loading { 
            text-align: center;
            color: #888;
            font-size: 1.2em;
            padding: 100px 0;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error {
            background: rgba(255, 77, 90, 0.1);
            border: 1px solid rgba(255, 77, 90, 0.2);
            color: #ff4d5a;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        
        .footer {
            text-align: center;
            margin-top: 60px;
            padding-bottom: 40px;
        }
        
        .last-update {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px 24px;
            border-radius: 30px;
            color: #888;
            font-size: 0.9em;
        }
        
        .update-dot {
            width: 8px;
            height: 8px;
            background: #00ff88;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.5); }
        }
        
        @media (max-width: 640px) {
            h1 { font-size: 2.5em; }
            .crypto-grid {
                grid-template-columns: 1fr;
            }
            .price { font-size: 1.8em; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>CRYPTO TRACKER</h1>
            <p class="subtitle">Real-time cryptocurrency prices powered by CoinGecko</p>
        </header>
        <div id="app">
            <div class="loading">
                <div class="loading-spinner"></div>
                <div>Loading market data...</div>
            </div>
        </div>
    </div>

    <script type="application/x-scittle">
        (ns crypto-app
          (:require [clojure.string :as str]
                    [reagent.core :as r]
                    [reagent.dom :as rdom]))

        (def app-state (r/atom {:prices {} :last-update nil :loading true :error nil}))

        ;; Crypto icons and symbols mapping
        (def crypto-icons
          {:bitcoin "₿"
           :ethereum "Ξ"
           :cardano "₳"
           :polkadot "●"
           :chainlink "⬡"
           :solana "◎"
           :avalanche-2 "▲"
           :polygon "Ⓜ"})
        
        (def crypto-symbols
          {:bitcoin "BTC"
           :ethereum "ETH"
           :cardano "ADA"
           :polkadot "DOT"
           :chainlink "LINK"
           :solana "SOL"
           :avalanche-2 "AVAX"
           :polygon "MATIC"})

        (defn format-number [n decimals]
          (.toLocaleString n "en-US" 
            #js{:minimumFractionDigits decimals 
                :maximumFractionDigits decimals}))

        (defn format-price [price]
          (str "$" (format-number price 2)))

        (defn format-volume [vol]
          (cond
            (>= vol 1e9) (str "$" (format-number (/ vol 1e9) 2) "B")
            (>= vol 1e6) (str "$" (format-number (/ vol 1e6) 2) "M")
            :else (str "$" (format-number vol 0))))

        (defn format-market-cap [cap]
          (format-volume cap))

        (defn crypto-card [crypto-id data]
          (let [name (-> crypto-id (str/replace "-" " ") str/capitalize)
                symbol (get crypto-symbols (keyword crypto-id) "")
                icon (get crypto-icons (keyword crypto-id) "◆")
                price (get data "usd")
                change (get data "usd_24h_change")
                volume (get data "usd_24h_vol")
                market-cap (get data "usd_market_cap")
                positive? (>= change 0)
                arrow (if positive? "▲" "▼")
                change-class (if positive? "change-positive" "change-negative")]
            [:div {:class "crypto-card"}
             [:div {:class "crypto-header"}
              [:div {:class "crypto-info"}
               [:div {:class "crypto-icon"} icon]
               [:div 
                [:div {:class "crypto-name"} 
                 name
                 [:span {:class "crypto-symbol"} symbol]]]]]
             [:div {:class "price"} (format-price price)]
             [:div {:class (str "change-container " change-class)}
              [:span {:class "arrow"} arrow]
              (format-number (js/Math.abs change) 2) "%"]
             [:div {:class "stats"}
              [:div {:class "stat"}
               [:div {:class "stat-label"} "24h Volume"]
               [:div {:class "stat-value"} (format-volume volume)]]
              [:div {:class "stat"}
               [:div {:class "stat-label"} "Market Cap"]
               [:div {:class "stat-value"} (format-market-cap market-cap)]]]]))

        (defn app-component []
          (let [{:keys [prices last-update loading error]} @app-state]
            [:div
             (cond
               error [:div {:class "error"} 
                      "Failed to load market data: " error 
                      [:br]
                      "Retrying in 30 seconds..."]
               loading [:div {:class "loading"} 
                        [:div {:class "loading-spinner"}]
                        [:div "Loading market data..."]]
               :else [:div
                      [:div {:class "crypto-grid"}
                       (for [[crypto-id data] prices]
                         ^{:key crypto-id} [crypto-card crypto-id data])]
                      (when last-update
                        [:div {:class "footer"}
                         [:div {:class "last-update"}
                          [:span {:class "update-dot"}]
                          "Last updated: " last-update]])])]))

        (defn fetch-crypto-data []
          (js/console.log "Starting crypto data fetch...")
          (swap! app-state assoc :loading true :error nil)
          (-> (js/fetch "./data/crypto-prices.json")
              (.then (fn [response]
                       (js/console.log "Fetch response received, status:" (.-status response))
                       (if (.-ok response)
                         (.json response)
                         (throw (js/Error. (str "HTTP " (.-status response)))))))
              (.then (fn [data]
                       (js/console.log "JSON data parsed:" data)
                       (let [js-data (js->clj data)
                             prices (dissoc js-data "timestamp" "source" "last_update")
                             last-update (get js-data "last_update")]
                         (js/console.log "Processed prices:" prices)
                         (swap! app-state assoc 
                                :prices prices 
                                :last-update last-update 
                                :loading false
                                :error nil))))
              (.catch (fn [error]
                        (js/console.error "Failed to fetch crypto data:" error)
                        (swap! app-state assoc 
                               :loading false 
                               :error (.-message error))))))

        ;; Initialize app with Reagent
        (defn mount-app []
          (rdom/render [app-component] (js/document.getElementById "app")))

        ;; Start the app
        (mount-app)
        
        ;; Add a timeout to show error if loading takes too long
        (js/setTimeout 
          (fn []
            (when (:loading @app-state)
              (swap! app-state assoc 
                     :loading false 
                     :error "Timeout loading data")))
          10000)
        
        ;; Fetch data immediately and then every 30 seconds
        (fetch-crypto-data)
        (js/setInterval fetch-crypto-data 30000)
    </script>
</body>
</html>