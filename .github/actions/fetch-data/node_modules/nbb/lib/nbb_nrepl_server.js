import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$node_process from"node:process";import*as esm_import$node_net from"node:net";import*as esm_import$node_fs from"node:fs";import*as esm_import$node_path from"node:path";
var fQa=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},U5=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},V5=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},gQa=function(a){return(new TextEncoder).encode(a).length},W5=function(a){return $APP.l($APP.dy.g($APP.q($APP.tV)))?console.debug($APP.Up.h(" ",a)):null},iQa=function(a){return function(b,c){b=$APP.wh(b);var d=$APP.C.h(b,$APP.Qt),e=$APP.C.h(b,hQa);c=$APP.lk.j(c,
"id",d);c=$APP.l(e)?$APP.lk.j(c,"session",e):c;return a.h?a.h(b,c):a.call(null,b,c)}},kQa=function(){var a=jQa;return function(b,c){b=$APP.Ap.j(b,X5,$APP.Yk);return a.h?a.h(b,c):a.call(null,b,c)}},mQa=function(){var a=lQa();return function(b,c){W5($APP.B(["request",b]));return a.h?a.h(b,c):a.call(null,b,c)}},nQa=function(a){return function(b,c){W5($APP.B(["response",c]));return a.h?a.h(b,c):a.call(null,b,c)}},lQa=function(){var a=kQa();return function(b,c){return a.h?a.h(b,c):a.call(null,b,c)}},oQa=
function(a){return $APP.lk.j($APP.zk(new $APP.G(null,3,5,$APP.I,["major","minor","incremental"],null),$APP.gC.g(a.split("."))),"version-string",a)},pQa=function(a,b,c){if($APP.l(a))if(a=Y5.g?Y5.g(a):Y5.call(null,a),$APP.l(a)){b=$APP.wh(b);var d=$APP.C.h(b,$APP.VCa),e=$APP.C.h(b,$APP.f_),f=$APP.C.h(b,$APP.h_);b=$APP.Db;var k=$APP.Rk,n=$APP.vY;$APP.Db=e;$APP.Rk=f;$APP.vY=d;try{var r=new $APP.tb;d=$APP.Fb;e=$APP.Gb;$APP.Fb=!0;$APP.Gb=function(p){return r.append(p)};try{a.g?a.g(c):a.call(null,c)}finally{$APP.Gb=
e,$APP.Fb=d}return $APP.m.g(r)}finally{$APP.vY=n,$APP.Rk=k,$APP.Db=b}}else return W5($APP.B(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.ul.l($APP.B([c]));else return $APP.ul.l($APP.B([c]))},qQa=function(a,b,c){$APP.jV.h($APP.SU,$APP.Rh(c));var d=$APP.Tt.g($APP.hm(c));d=$APP.l(d)?d:c.message;$APP.l(d)&&(d=new $APP.h(null,1,["err",[$APP.m.g(d),"\n"].join("")],null),a.h?a.h(b,d):a.call(null,b,d));c=new $APP.h(null,2,["ex",$APP.m.g(c),"ns",$APP.m.g($APP.q($APP.Yt))],
null);return a.h?a.h(b,c):a.call(null,b,c)},vQa=function(a,b){var c=$APP.wh(a),d=$APP.C.h(c,$APP.W);a=$APP.C.h(c,Z5);var e=$APP.C.h(c,$APP.bo);$APP.C.h(c,rQa);$APP.C.h(c,sQa);var f=$APP.Es(a),k=function p(r){try{var y=function(){var E=$APP.W.g($APP.Le(r));if($APP.l(E))return E;E=$APP.q($5);return $APP.l(E)?E:d}(),z=$APP.$fa(f,new $APP.h(null,3,[$APP.W,y,$APP.bo,e,$APP.cP,$APP.kA],null));return $APP.x.h($APP.iL,z)?Promise.resolve(r):$APP.HAa(z,new $APP.h(null,3,[$APP.W,y,$APP.bo,e,$APP.cP,$APP.kA],
null)).then(function(E){var H=$APP.A.j(E,0,null),P=$APP.A.j(E,1,null);P=$APP.W.g(P);$APP.Th($5,P);$APP.jV.h($APP.RU,$APP.Rh($APP.q($APP.QU)));$APP.jV.h($APP.QU,$APP.Rh($APP.q($APP.PU)));$APP.jV.h($APP.PU,$APP.Rh(H));H=pQa(tQa.g(c),uQa.g(c),H);H=new $APP.h(null,2,["value",H,"ns",$APP.m.g(P)],null);b.h?b.h(c,H):b.call(null,c,H);return p(E)})}catch(E){return qQa(b,c,E),p(null)}};$APP.ft($APP.th([$APP.Yt,d,$APP.Ht,e,$APP.FT,$APP.q($APP.FT),$APP.KT,!0]));return function(){$APP.jV.h($APP.DT,$APP.Rh(function(r){r=
new $APP.h(null,1,["out",r],null);return b.h?b.h(c,r):b.call(null,c,r)}));return k(null).catch($APP.Wn.j(qQa,b,c)).finally(function(){var r=new $APP.h(null,2,["ns",$APP.m.g($APP.q($5)),"status",new $APP.G(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(c,r):b.call(null,c,r)})}().finally(function(){return $APP.ht()})},wQa=function(a,b){a=$APP.wh(a);var c=$APP.C.h(a,$APP.W),d=$APP.lk.j;c=$APP.l(c)?$APP.vX($APP.gy(),$APP.el.g(c)):null;$APP.l(c)||(c=$APP.q($5),c=$APP.l(c)?c:$APP.q($APP.Yt));return vQa(d.call($APP.lk,
a,$APP.W,c),b)},a6=function(a,b){var c=$APP.wh(a),d=$APP.C.h(c,$APP.W),e=X5.g(c);try{var f=$APP.W.g(c),k=function(){var P=$APP.Nla.g(c);return $APP.l(P)?P:$APP.Uo.g(c)}(),n=function(){var P=$APP.l(d)?$APP.vX($APP.gy(),$APP.el.g(d)):null;if($APP.l(P))return P;P=$APP.q($5);return $APP.l(P)?P:$APP.q($APP.Yt)}(),r=$APP.th([$APP.Yt,n]);$APP.ft(r);try{var p=$APP.Kx($APP.gy(),$APP.T5("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,k)),y=$APP.M.g(p),z=$APP.bo.g(p),E=$APP.co.g(p),H=function(){var P=e instanceof $APP.F?e.ga:null;switch(P){case "eldoc":return P=new $APP.h(null,5,["ns",$APP.W.g(p),"name",$APP.O.g(p),"eldoc",$APP.Xp.h(function(V){return $APP.Xp.h($APP.m,V)},$APP.Z.g(p)),"type",$APP.qf($APP.Ox.g(p))?"function":"variable","status",new $APP.G(null,1,5,$APP.I,["done"],null)],null),$APP.l(y)?$APP.lk.j(P,"docstring",y):P;case "info":case "lookup":return P=new $APP.h(null,4,["ns",$APP.W.g(p),"name",$APP.O.g(p),"arglists-str",
$APP.Up.h("\n",$APP.Xk.h($APP.ul,$APP.Z.g(p))),"status",new $APP.G(null,1,5,$APP.I,["done"],null)],null),P=$APP.l(y)?$APP.lk.j(P,"doc",y):P,P=$APP.l(z)?$APP.lk.j(P,"file",z):P,$APP.l(E)?$APP.lk.j(P,"line",E):P;default:throw Error(["No matching clause: ",$APP.m.g(P)].join(""));}}();return b.h?b.h(c,H):b.call(null,c,H)}finally{$APP.ht()}}catch(P){if(P instanceof Error)return a=P,f=function(){var V=new $APP.ok(null,new $APP.h(null,1,["done",null],null),null);return $APP.x.h(e,xQa)?$APP.Og.h(V,"no-eldoc"):
V}(),a=new $APP.h(null,2,["status",f,"ex",$APP.m.g(a)],null),b.h?b.h(c,a):b.call(null,c,a);throw P;}},jQa=function(a,b){a=$APP.wh(a);var c=$APP.C.h(a,X5),d=$APP.C.h(yQa,c);if($APP.l(d))return d.h?d.h(a,b):d.call(null,a,b);console.warn($APP.Up.h(" ",$APP.B(["Unhandled operation",c])));c=new $APP.h(null,1,["status",new $APP.G(null,3,5,$APP.I,["error","unknown-op","done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},zQa=function(a){return function(b,c){return a.write(b6(c))}},AQa=function(a,b){W5($APP.B(["Connection accepted"]));
b.setNoDelay(!0);var c=mQa(),d=iQa(nQa(zQa(b))),e=$APP.yl.g(null);b.on("data",function(f){var k=$APP.q(e);if($APP.l(k)){f=[$APP.m.g(k),$APP.m.g(f)].join("");$APP.Th(e,null);var n=f}else n=f;a:for(f=$APP.B([$APP.hC,!0]),k=$APP.pi;;){var r=$APP.Ph.j(c6,n,f);n=$APP.A.j(r,0,null);r=$APP.A.j(r,1,null);if(null==n){k=new $APP.G(null,2,5,$APP.I,[k,r],null);break a}k=$APP.Og.h(k,n);n=r}f=$APP.A.j(k,0,null);k=$APP.A.j(k,1,null);$APP.mn(k)||$APP.Th(e,k);f=$APP.u(f);k=null;for(var p=r=0;;)if(p<r)n=k.U(null,p),
c(n,d),p+=1;else if(f=$APP.u(f))k=f,$APP.gf(k)?(f=$APP.yd(k),r=$APP.zd(k),k=f,n=$APP.Ge(f),f=r,r=n):(n=$APP.v(k),c(n,d),f=$APP.w(k),k=null,r=0),p=0;else return null});return b.on("close",function(f){return $APP.l(f)?W5($APP.B(["Connection lost"])):W5($APP.B(["Connection closed"]))})},d6=function(a){return Promise.resolve($APP.uX(esm_import$node_path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.FAa(new $APP.D(null,$APP.Am,new $APP.D(null,new $APP.D(null,$APP.Am,new $APP.D(null,
e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.A.j($APP.uV,0,null),d=$APP.A.j($APP.uV,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.Un.l($APP.B([$APP.q($APP.tV),a])),c=function(){var f=$APP.yK.g(b);return $APP.l(f)?f:0}(),d=function(){var f=$APP.PR.g(b);return $APP.l(f)?f:"127.0.0.1"}();(function(){var f=$APP.Rb(b)?b.Vk:BQa.g(b);return $APP.l(f)?f:"info"})();var e=esm_import$node_net.createServer($APP.Wn.h(AQa,$APP.uh));e.listen(c,d,function(){var f=e.address(),
k=f.port;f=f.address;$APP.WB.l($APP.B([["nREPL server started on port ",$APP.m.g(k)," on host ",$APP.m.g(f)," - nrepl://",$APP.m.g(f),":",$APP.m.g(k)].join("")]));$APP.jV.h($APP.KT,$APP.Rh(!0));try{return esm_import$node_fs.writeFileSync(".nrepl-port",$APP.m.g(k))}catch(n){return console.warn($APP.Up.h(" ",$APP.B(["Could not write .nrepl-port",n])))}});return $APP.Th(CQa,e)})},DQa=new $APP.t("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",1628751782,null),uQa=new $APP.F("nrepl.middleware.print",
"options","nrepl.middleware.print/options",868480159),EQa=new $APP.t(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),hQa=new $APP.F(null,"session","session",1008279103),FQa=new $APP.t("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,null),GQa=new $APP.F(null,"load-file","load-file",-424586670),Z5=new $APP.F(null,"code","code",1586293142),BQa=new $APP.F(null,"log_level","log_level",-1756736313),tQa=new $APP.F("nrepl.middleware.print",
"print","nrepl.middleware.print/print",-1616742548),HQa=new $APP.F(null,"clone","clone",711747572),IQa=new $APP.F(null,"close","close",1835149582),JQa=new $APP.F(null,"info","info",-317069002),KQa=new $APP.F(null,"macroexpand","macroexpand",-130598183),LQa=new $APP.F(null,"complete","complete",-500388775),sQa=new $APP.F(null,"_line","_line",232847719),e6=new $APP.t(null,"server","server",-1155245649,null),MQa=new $APP.F(null,"lookup","lookup",1225356838),NQa=new $APP.F(null,"expander","expander",
379138924),rQa=new $APP.F(null,"_load-file?","_load-file?",-1198848711),X5=new $APP.F(null,"op","op",-1882987955),OQa=new $APP.F(null,"describe","describe",1369790582),xQa=new $APP.F(null,"eldoc","eldoc",-1321421900),PQa=new $APP.t(null,"stop-server!","stop-server!",-410772185,null),QQa=new $APP.F(null,"load-file?","load-file?",1892536169);var f6=function f6(a,b){switch($APP.m.g(V5(a,1))){case "i":return a=U5(a,1),b=fQa(a,"e"),new $APP.G(null,2,5,$APP.I,[parseInt(V5(a,b)),U5(a,b+1)],null);case "l":var d=a=U5(a,1);for(a=$APP.od($APP.pi);;){if($APP.x.h($APP.m.g(V5(d,1)),"e"))return new $APP.G(null,2,5,$APP.I,[$APP.qd(a),U5(d,1)],null);var e=f6.h?f6.h(d,b):f6.call(null,d,b),f=$APP.A.j(e,0,null),k=$APP.A.j(e,1,null);e=k;a=$APP.oi.h(a,f);d=e}case "d":for(a=U5(a,1),f=$APP.wh(b),f=$APP.C.h(f,$APP.hC),d=a,e=$APP.od($APP.uh);;){if($APP.x.h($APP.m.g(V5(d,
1)),"e"))return new $APP.G(null,2,5,$APP.I,[$APP.qd(e),U5(d,1)],null);a=f6.h?f6.h(d,b):f6.call(null,d,b);d=$APP.A.j(a,0,null);k=$APP.A.j(a,1,null);k=f6.h?f6.h(k,b):f6.call(null,k,b);a=$APP.A.j(k,0,null);k=$APP.A.j(k,1,null);d=$APP.l(f)?$APP.Yk.g(d):d;a=$APP.lj.j(e,d,a);d=k;e=a}default:return b=fQa(a,":"),f=parseInt(V5(a,b)),a=U5(a,b+1),new $APP.G(null,2,5,$APP.I,[$APP.m.g(V5(a,f)),U5(a,f)],null)}},c6=function c6(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return c6.l(arguments[0],1<c.length?new $APP.ce(c.slice(1),0,null):null)};c6.l=function(a,b){try{return f6(a,b)}catch(c){if(c instanceof Error)return new $APP.G(null,2,5,$APP.I,[null,a],null);throw c;}};c6.o=1;c6.A=function(a){var b=$APP.v(a);a=$APP.w(a);return this.l(b,a)};
var b6=function b6(a){for(;;){if("string"===typeof a)return[$APP.m.g(gQa(a)),":",a].join("");if(a instanceof $APP.F||a instanceof $APP.t)a=[function(){var c=$APP.Vg(a);return $APP.l(c)?[c,"/"].join(""):null}(),$APP.yk(a)].join("");else return"number"===typeof a?["i",$APP.m.g(a),"e"].join(""):$APP.af(a)||$APP.ff(a)||null==a?["l",$APP.m.g($APP.Ph.h($APP.m,$APP.Xk.h(b6,a))),"e"].join(""):$APP.df(a)?["d",$APP.m.g($APP.Ph.h($APP.m,$APP.Xk.h(function(){return function(c){var d=$APP.A.j(c,0,null);c=$APP.A.j(c,
1,null);return[$APP.m.g(b6.g?b6.g(d):b6.call(null,d)),$APP.m.g(b6.g?b6.g(c):b6.call(null,c))].join("")}}(a),$APP.PA.h($APP.v,a)))),"e"].join(""):null}};var $5=$APP.yl.g(null),Y5=new $APP.h(null,1,["cider.nrepl.pprint/pprint",$APP.r_],null),yQa=$APP.Sj([$APP.BX,MQa,IQa,GQa,xQa,HQa,OQa,JQa,LQa,KQa,$APP.vra],[function(a,b){var c=new $APP.h(null,2,["status",new $APP.G(null,1,5,$APP.I,["done"],null),"classpath",$APP.jn.h($APP.Hs(),$APP.Qk(esm_import$node_path.delimiter))],null);return b.h?b.h(a,c):b.call(null,a,c)},a6,function(a,b){var c=new $APP.h(null,1,["status",new $APP.G(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},
function(a,b){a=$APP.wh(a);var c=$APP.C.h(a,$APP.bo);return vQa($APP.lk.l(a,Z5,c,$APP.B([QQa,!0,$APP.W,$APP.q($APP.Yt)])),b)},a6,function(a,b){var c=new $APP.h(null,2,["new-session",$APP.m.g($APP.em()),"status",new $APP.G(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.h(null,4,["versions",new $APP.h(null,2,["nbb-nrepl",oQa("TODO"),"node",oQa(esm_import$node_process.version)],null),"aux",$APP.uh,"ops",$APP.zk($APP.Xk.h($APP.yk,$APP.gk(yQa)),
$APP.Op.g($APP.uh)),"status",new $APP.G(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},a6,function(a,b){var c=$APP.OAa(a);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){a=$APP.wh(a);var c=$APP.C.h(a,Z5),d=$APP.C.h(a,NQa);try{return wQa($APP.lk.j(a,Z5,["( ",$APP.m.g(d),"(quote ",$APP.m.g(c),"))"].join("")),function(e,f){var k=f.g?f.g("value"):f.call(null,"value");f=$APP.l(k)?$APP.lk.j(f,"expansion",k):f;return b.h?b.h(e,f):b.call(null,e,f)})}catch(e){if(e instanceof
Error)return c=new $APP.h(null,3,["ex",$APP.m.g(e),"ns",$APP.m.g($APP.q($APP.Yt)),"status",new $APP.G(null,1,5,$APP.I,["done"],null)],null),b.h?b.h(a,c):b.call(null,a,c);throw e;}},wQa]),CQa=$APP.yl.g(null),g6=function g6(a){switch(arguments.length){case 0:return g6.v();case 1:return g6.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};g6.v=function(){return g6.g($APP.q(CQa))};
g6.g=function(a){return a.close(function(){$APP.jV.h($APP.DT,$APP.Rh($APP.Gb));$APP.jV.h($APP.KT,$APP.Rh($APP.Fb));return $APP.l(esm_import$node_fs.existsSync(".nrepl-port"))?esm_import$node_fs.unlinkSync(".nrepl-port"):null})};g6.o=1;
var RQa=$APP.nV.h($APP.hD,null),SQa=new $APP.h(null,2,[$APP.AX,function(){var a=new $APP.ae(function(){return d6},FQa,$APP.Sj([$APP.W,$APP.O,$APP.bo,$APP.WC,$APP.ip,$APP.co,$APP.zS,$APP.Z,$APP.M,$APP.YI],[$APP.Ue(EQa,new $APP.h(null,1,[$APP.M,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.AX,"nbb/impl/nrepl_server.cljs",20,1,327,327,$APP.J(new $APP.G(null,1,5,$APP.I,[$APP.IK],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",
$APP.l(d6)?d6.D:null])),b=$APP.q(a),c=$APP.Ve(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.h(null,4,[$APP.W,RQa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.hu.g(c))?$APP.hV.j(a,b,d):$APP.l(function(){var e=$APP.tt.g(c);return $APP.l(e)?e:$APP.Jt.g(c)}())?$APP.iV.j(a,b,d):$APP.Nx.j(a,b,d)}(),PQa,function(){var a=new $APP.ae(function(){return g6},DQa,$APP.Sj([$APP.W,$APP.O,$APP.bo,$APP.WC,$APP.yO,$APP.ip,$APP.co,$APP.zS,$APP.Z,$APP.M,$APP.YI],[$APP.Ue(EQa,new $APP.h(null,
1,[$APP.M,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),PQa,"nbb/impl/nrepl_server.cljs",19,new $APP.h(null,6,[$APP.zD,!1,$APP.uw,1,$APP.TQ,1,$APP.iQ,new $APP.G(null,2,5,$APP.I,[$APP.pi,new $APP.G(null,1,5,$APP.I,[e6],null)],null),$APP.Z,$APP.J($APP.pi,new $APP.G(null,1,5,$APP.I,[e6],null)),$APP.SI,$APP.J(null,null)],null),1,398,398,$APP.J($APP.pi,new $APP.G(null,1,5,$APP.I,[e6],null)),null,$APP.l(g6)?g6.D:null])),b=$APP.q(a),c=$APP.Ve(a);a=$APP.l(null)?null:
$APP.O.g(c);var d=new $APP.h(null,4,[$APP.W,RQa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.hu.g(c))?$APP.hV.j(a,b,d):$APP.l(function(){var e=$APP.tt.g(c);return $APP.l(e)?e:$APP.Jt.g(c)}())?$APP.iV.j(a,b,d):$APP.Nx.j(a,b,d)}()],null);$APP.Ay(new $APP.h(null,1,[$APP.Vt,new $APP.h(null,1,[$APP.hD,SQa],null)],null));