import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$node_net from"node:net";import*as esm_import$node_process from"node:process";import*as esm_import$node_readline from"node:readline";import*as esm_import$node_vm from"node:vm";
var y3=function(a){var b=function(){var e=$APP.gv.h(a,"(");return $APP.l(e)?new $APP.G(null,2,5,$APP.I,[$APP.Pk.j(a,0,e+1),$APP.Pk.h(a,e+1)],null):new $APP.G(null,2,5,$APP.I,[null,a],null)}(),c=$APP.A.j(b,0,null),d=$APP.A.j(b,1,null);b=$APP.C.h(function(){try{return $APP.OAa(new $APP.h(null,2,[$APP.W,$APP.m.g($APP.q(x3)),$APP.oM,d],null))}catch(f){var e=f;console.warn($APP.m.g($APP.$ra),$APP.im(e));return null}}(),"completions");return $APP.Xk.h(function(e){return[$APP.m.g(c),$APP.m.g(e)].join("")},
$APP.qi(function(e){return $APP.Ha(e,d)},$APP.Xk.h(function(e){return $APP.C.h(e,"candidate")},b)))},sKa=function(a){return[$APP.cw.g(y3(a)),a]},C3=function(a,b){$APP.Th(z3,!1);a.setPrompt([$APP.m.g($APP.q(x3)),"\x3d\x3e "].join(""));a.prompt();return $APP.mn($APP.q(A3))?null:B3.h?B3.h(b,a):B3.call(null,b,a)},tKa=function(a){var b=$APP.zn(a);a=$APP.An(a);var c=$APP.kn($APP.q(A3));b=$APP.fi.h(b-1,c);c=$APP.u(b);b=$APP.v(c);c=$APP.w(c);a=$APP.l(b)?$APP.Pk.h(b,a):null;$APP.Th(A3,$APP.Up.h("\n",$APP.Sg(a,
c)))},uKa=function(a,b){b={f:b};esm_import$node_vm.createContext(b);try{return $APP.l($APP.l(D3)?$APP.Ob(a):D3)&&esm_import$node_process.stdin.setRawMode(!1),esm_import$node_vm.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.l(a)?function(){return c}:function(){var e=$APP.v(c);$APP.cy.l($APP.B([e]));return c}};esm_import$node_vm.createContext(d);return esm_import$node_vm.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,
microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.l($APP.l(D3)?$APP.Ob(a):D3)?esm_import$node_process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.l($APP.l(D3)?$APP.Ob(a):D3)&&esm_import$node_process.stdin.setRawMode(!0),Promise.reject(b)}},B3=function(a,b){if($APP.l(function(){var e=$APP.q(z3);return $APP.l(e)?e:$APP.mn($APP.q(A3))}()))return null;$APP.Th(z3,!0);var c=$APP.Es($APP.q(A3)),d=function(){try{var e=$APP.th([$APP.Yt,$APP.q(x3)]);$APP.ft(e);try{return $APP.Zfa(c)}finally{$APP.ht()}}catch(f){e=
f;if($APP.Ka($APP.im(e),"EOF while reading"))return vKa;tKa(c);$APP.cy.l($APP.B([$APP.m.g(e)]));return wKa}}();if($APP.x.h(wKa,d))return C3(b,a);if($APP.x.h(vKa,d))return $APP.Th(z3,!1);tKa(c);if($APP.x.h($APP.iL,d))return $APP.Th(z3,!1);$APP.ft($APP.th([$APP.Yt,$APP.q(x3)]));return uKa(a,function(){return $APP.HAa(d,new $APP.h(null,3,[$APP.W,$APP.q(x3),$APP.bo,$APP.q($APP.Ht),$APP.cP,$APP.kA],null))}).then(function(e){var f=$APP.A.j(e,0,null);e=$APP.A.j(e,1,null);e=$APP.wh(e);e=$APP.C.h(e,$APP.W);
$APP.Th(x3,e);$APP.jV.h($APP.RU,$APP.Rh($APP.q($APP.QU)));$APP.jV.h($APP.QU,$APP.Rh($APP.q($APP.PU)));$APP.jV.h($APP.PU,$APP.Rh(f));$APP.l(a)&&a.write($APP.TB.l($APP.B([f])));return C3(b,a)}).catch(function(e){$APP.cy.l($APP.B([$APP.m.g(e)]));$APP.jV.h($APP.SU,$APP.Rh(e));return C3(b,a)}).finally(function(){return $APP.ht()})},xKa=function(a,b){a.on("line",function(c){$APP.zl.B(A3,$APP.m,c,"\n");return B3(b,a)})},yKa=function(a){return esm_import$node_readline.createInterface({input:a,output:a,completer:sKa})},
zKa=function(a){var b=yKa(a);xKa(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.WB.l($APP.B(["Client closed connection."]))})},E3=new $APP.t(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),vKa=new $APP.F("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),AKa=new $APP.t("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),BKa=new $APP.t("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null),CKa=new $APP.t(null,"completer*",
"completer*",-648150376,null),DKa=new $APP.t("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null),EKa=new $APP.F(null,"init","init",-1875481434),FKa=new $APP.t(null,"get-completions","get-completions",1933789168,null),wKa=new $APP.F("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644);var x3=$APP.yl.g($APP.q($APP.Yt)),A3=$APP.yl.g(""),z3=$APP.yl.g(!1),D3,GKa=esm_import$node_process.stdout.isTTY;D3=$APP.l(GKa)?esm_import$node_process.stdin.setRawMode:GKa;var F3=$APP.nV.h($APP.qC,null),G3=function G3(a){switch(arguments.length){case 0:return G3.v();case 1:return G3.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};G3.v=function(){return G3.g(null)};
G3.g=function(a){var b=function(){var d=$APP.yK.g(a);return $APP.l(d)?d:0}(),c=esm_import$node_net.createServer(zKa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.WB.l($APP.B([["Socket REPL listening on port ",$APP.m.g(d.port)," on host ",$APP.m.g(e)].join("")]))})};G3.o=1;var H3=function H3(a){switch(arguments.length){case 0:return H3.v();case 1:return H3.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};H3.v=function(){return H3.g(null)};
H3.g=function(a){function b(e){return $APP.FAa(new $APP.D(null,$APP.Am,new $APP.D(null,new $APP.D(null,$APP.Am,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}$APP.l(D3)&&esm_import$node_process.stdin.setRawMode(!0);var c=$APP.A.j($APP.uV,0,null),d=$APP.A.j($APP.uV,1,null);$APP.WB.l($APP.B([["Welcome to nbb v",$APP.Ly(),"!"].join("")]));return b(c).then(function(){return b(d)}).then(EKa.h(a,$APP.Mf)).then(function(){return new Promise(function(e){var f=$APP.l(null)?yKa(null):esm_import$node_readline.createInterface({input:esm_import$node_process.stdin,
output:esm_import$node_process.stdout,completer:sKa});xKa(f,null);f.setPrompt([$APP.m.g($APP.q(x3)),"\x3d\x3e "].join(""));f.on("close",e);return f.prompt()})})};H3.o=1;
var HKa=new $APP.h(null,3,[$APP.zX,function(){var a=new $APP.ae(function(){return H3},BKa,$APP.Sj([$APP.W,$APP.O,$APP.bo,$APP.WC,$APP.yO,$APP.ip,$APP.co,$APP.zS,$APP.Z,$APP.M,$APP.YI],[E3,$APP.zX,"nbb/impl/repl.cljs",11,new $APP.h(null,6,[$APP.zD,!1,$APP.uw,1,$APP.TQ,1,$APP.iQ,new $APP.G(null,2,5,$APP.I,[$APP.pi,new $APP.G(null,1,5,$APP.I,[$APP.IK],null)],null),$APP.Z,$APP.J($APP.pi,new $APP.G(null,1,5,$APP.I,[$APP.IK],null)),$APP.SI,$APP.J(null,null)],null),1,187,187,$APP.J($APP.pi,new $APP.G(null,
1,5,$APP.I,[$APP.IK],null)),null,$APP.l(H3)?H3.D:null])),b=$APP.q(a),c=$APP.Ve(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.h(null,4,[$APP.W,F3,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.hu.g(c))?$APP.hV.j(a,b,d):$APP.l(function(){var e=$APP.tt.g(c);return $APP.l(e)?e:$APP.Jt.g(c)}())?$APP.iV.j(a,b,d):$APP.Nx.j(a,b,d)}(),FKa,function(){var a=new $APP.ae(function(){return y3},AKa,$APP.Sj([$APP.W,$APP.O,$APP.bo,$APP.WC,$APP.ip,$APP.co,$APP.zS,$APP.Z,$APP.M,$APP.YI],
[E3,CKa,"nbb/impl/repl.cljs",17,1,16,16,$APP.J(new $APP.G(null,1,5,$APP.I,[$APP.zka],null)),"Given a line, returns a flat vector of completions",$APP.l(y3)?y3.D:null])),b=$APP.q(a),c=$APP.Ve(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.h(null,4,[$APP.W,F3,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.hu.g(c))?$APP.hV.j(a,b,d):$APP.l(function(){var e=$APP.tt.g(c);return $APP.l(e)?e:$APP.Jt.g(c)}())?$APP.iV.j(a,b,d):$APP.Nx.j(a,b,d)}(),$APP.yX,function(){var a=new $APP.ae(function(){return G3},
DKa,$APP.Sj([$APP.W,$APP.O,$APP.bo,$APP.WC,$APP.yO,$APP.ip,$APP.co,$APP.zS,$APP.Z,$APP.M,$APP.YI],[E3,$APP.yX,"nbb/impl/repl.cljs",18,new $APP.h(null,6,[$APP.zD,!1,$APP.uw,1,$APP.TQ,1,$APP.iQ,new $APP.G(null,2,5,$APP.I,[$APP.pi,new $APP.G(null,1,5,$APP.I,[$APP.IK],null)],null),$APP.Z,$APP.J($APP.pi,new $APP.G(null,1,5,$APP.I,[$APP.IK],null)),$APP.SI,$APP.J(null,null)],null),1,172,172,$APP.J($APP.pi,new $APP.G(null,1,5,$APP.I,[$APP.IK],null)),null,$APP.l(G3)?G3.D:null])),b=$APP.q(a),c=$APP.Ve(a);a=
$APP.l(null)?null:$APP.O.g(c);var d=new $APP.h(null,4,[$APP.W,F3,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.hu.g(c))?$APP.hV.j(a,b,d):$APP.l(function(){var e=$APP.tt.g(c);return $APP.l(e)?e:$APP.Jt.g(c)}())?$APP.iV.j(a,b,d):$APP.Nx.j(a,b,d)}()],null);$APP.Ay(new $APP.h(null,1,[$APP.Vt,new $APP.h(null,1,[$APP.qC,HKa],null)],null));